<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Historic Hurricanes (1851-2015)</title>

  <!-- Load Calcite components from CDN -->
  <script type="module" src="https://js.arcgis.com/calcite-components/3.2.1/calcite.esm.js"></script>

  <!-- Load the ArcGIS Maps SDK for JavaScript from CDN -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/dark/main.css" />
  <script src="https://js.arcgis.com/4.32/"></script>

  <!-- Load Map components from CDN-->
  <script type="module" src="https://js.arcgis.com/4.32/map-components/"></script>
  <link rel="stylesheet" href="main.css" />
</head>

<body class="calcite-mode-dark">
  <calcite-shell>
    <div slot="header" id="header">
      <div id="heading">
        Animated Hurricane Tracks (1851-2015)
      </div>
      <div id="subheading">Explore hurricanes from <calcite-select id="year-select"></calcite-select> using the time
        slider below.
      </div>
    </div>
    <arcgis-map>
      <arcgis-zoom position="top-left"></arcgis-zoom>
      <arcgis-expand position="top-left" expand-icon="legend" label="Legend">
        <arcgis-placement slot="panel-top">
          <div id="legend-content">
            <h3>Legend</h3>
            <img src="legend.png" id="legend-img" alt="Hurricane Image" />
          </div>
        </arcgis-placement>
      </arcgis-expand>
    </arcgis-map>
    <calcite-shell-panel id="slider-panel" slot="panel-bottom" layout="horizontal">
      <arcgis-time-slider layout="auto" mode="cumulative-from-start" reference-element="arcgis-map"
        play-rate="20"></arcgis-time-slider>
    </calcite-shell-panel>
  </calcite-shell>

  <script type="module">
    const [WebMap, Color, GeoJSONLayer, CIMSymbol] = await $arcgis.import([
      "@arcgis/core/WebMap.js",
      "@arcgis/core/Color.js",
      "@arcgis/core/layers/GeoJSONLayer.js",
      "@arcgis/core/symbols/CIMSymbol.js",
    ]);

    const yearSlider = document.querySelector("arcgis-time-slider");
    const viewElement = document.querySelector("arcgis-map");
    const yearSelect = document.getElementById("year-select");

    await yearSelect.componentOnReady();

    for (let year = 1851; year <= 2015; year++) {
      const option = document.createElement("calcite-option");
      option.value = year;
      option.label = `${year} - ${year + 1}`;
      option.selected = year === 2005;
      yearSelect.appendChild(option);
    }

    const startYear = 2005;
    const endYear = startYear + 1;

    // Esri color ramps - Plasma
    const plasma = ["#8d01efff", "#bf09eeff", "#ff51bdff", "#ff9d82ff", "#ffc666ff", "#ffff35ff"];

    const colors = plasma.map((c, i) => {
      const newColor = new Color(c);
      newColor.a = i / 5;
      return newColor;
    });

    const southRings = [
      [
        [12.36, 10.8],
        [11.76, 10.92],
        [11.26, 11.26],
        [10.92, 11.76],
        [10.8, 12.36],
        [10.8, 12.64],
        [10.92, 13.24],
        [11.26, 13.74],
        [11.76, 14.08],
        [12.36, 14.2],
        [12.64, 14.2],
        [13.24, 14.08],
        [13.74, 13.74],
        [14.08, 13.24],
        [14.2, 12.64],
        [14.2, 12.36],
        [14.08, 11.76],
        [13.74, 11.26],
        [13.24, 10.92],
        [12.64, 10.8],
        [12.36, 10.8]
      ],
      [
        [17, 5.45],
        [16, 5.37],
        [14.91, 5.45],
        [13.85, 5.67],
        [12.84, 6.05],
        [11.63, 6.7],
        [10.57, 7.48],
        [9.65, 8.4],
        [8.84, 9.48],
        [8.82, 9.52],
        [8.5, 10.11],
        [8.24, 10.86],
        [8.06, 11.7],
        [8, 12.5],
        [8.15, 13.65],
        [8.59, 14.72],
        [9.3, 15.65],
        [10.23, 16.37],
        [10.23, 16.37],
        [10.95, 16.98],
        [11.14, 17.27],
        [11.2, 17.55],
        [10.99, 18.01],
        [10.37, 18.51],
        [9.33, 19.05],
        [8, 19.55],
        [9, 19.64],
        [10.09, 19.56],
        [11.15, 19.33],
        [12.16, 18.95],
        [13.38, 18.3],
        [14.43, 17.52],
        [15.36, 16.6],
        [16.16, 15.52],
        [16.18, 15.48],
        [16.5, 14.89],
        [16.76, 14.14],
        [16.94, 13.3],
        [17, 12.5],
        [16.85, 11.35],
        [16.41, 10.28],
        [15.7, 9.35],
        [14.77, 8.63],
        [14.05, 8.02],
        [13.86, 7.73],
        [13.8, 7.45],
        [14.01, 6.99],
        [14.63, 6.49],
        [15.67, 5.95],
        [17, 5.45]
      ]
    ];

    const northRings = [
      [
        [12.36, 10.8],
        [11.76, 10.92],
        [11.26, 11.26],
        [10.92, 11.76],
        [10.8, 12.36],
        [10.8, 12.64],
        [10.92, 13.24],
        [11.26, 13.74],
        [11.76, 14.08],
        [12.36, 14.2],
        [12.64, 14.2],
        [13.24, 14.08],
        [13.74, 13.74],
        [14.08, 13.24],
        [14.2, 12.64],
        [14.2, 12.36],
        [14.08, 11.76],
        [13.74, 11.26],
        [13.24, 10.92],
        [12.64, 10.8],
        [12.36, 10.8]
      ],
      [
        [8, 5.45],
        [9, 5.37],
        [10.09, 5.45],
        [11.15, 5.67],
        [12.16, 6.05],
        [13.37, 6.7],
        [14.43, 7.48],
        [15.35, 8.4],
        [16.16, 9.48],
        [16.18, 9.52],
        [16.5, 10.11],
        [16.76, 10.86],
        [16.94, 11.7],
        [17, 12.5],
        [16.85, 13.65],
        [16.41, 14.72],
        [15.7, 15.65],
        [14.77, 16.37],
        [14.77, 16.37],
        [14.05, 16.98],
        [13.86, 17.27],
        [13.8, 17.55],
        [14.01, 18.01],
        [14.63, 18.51],
        [15.67, 19.05],
        [17, 19.55],
        [16, 19.64],
        [14.91, 19.56],
        [13.85, 19.33],
        [12.84, 18.95],
        [11.62, 18.3],
        [10.57, 17.52],
        [9.64, 16.6],
        [8.84, 15.52],
        [8.82, 15.48],
        [8.5, 14.89],
        [8.24, 14.14],
        [8.06, 13.3],
        [8, 12.5],
        [8.15, 11.35],
        [8.59, 10.28],
        [9.3, 9.35],
        [10.23, 8.63],
        [10.95, 8.02],
        [11.14, 7.73],
        [11.2, 7.45],
        [10.99, 6.99],
        [10.37, 6.49],
        [9.33, 5.95],
        [8, 5.45]
      ]
    ];

    const hurricaneSymbol_north = new CIMSymbol({
      data: {
        type: "CIMSymbolReference",
        symbol: {
          type: "CIMPointSymbol",
          symbolLayers: [
            {
              type: "CIMVectorMarker",
              enable: true,
              colorLocked: true,
              anchorPointUnits: "Relative",
              dominantSizeAxis3D: "Y",
              size: 25,
              billboardMode3D: "FaceNearPlane",
              frame: {
                xmin: 0,
                ymin: 0,
                xmax: 25,
                ymax: 25
              },
              animations: [
                {
                  type: "CIMSymbolAnimationRotation",
                  // primitiveName: "scaleOverride",
                  toRotation: 360,
                  rotateClockwise: false,
                  animatedSymbolProperties: {
                    type: "CIMAnimatedSymbolProperties",
                    // primitiveName: "animationOverride",
                    playAnimation: true,
                    randomizeStartTime: false,
                    repeatType: "Loop",
                    repeatDelay: 0,
                    duration: 1.5
                  }
                }
              ],
              markerGraphics: [
                {
                  type: "CIMMarkerGraphic",
                  geometry: {
                    rings: northRings
                  },
                  symbol: {
                    type: "CIMPolygonSymbol",
                    symbolLayers: [
                      {
                        type: "CIMSolidFill",
                        enable: true,
                        color: [255, 87, 71, 255]
                      }
                    ],
                    angleAlignment: "Map"
                  }
                }
              ],
              scaleSymbolsProportionally: true,
              respectFrame: true,
              clippingPath: {
                type: "CIMClippingPath",
                clippingType: "Intersect",
                path: {
                  rings: [
                    [
                      [0, 0],
                      [25, 0],
                      [25, 25],
                      [0, 25],
                      [0, 0]
                    ]
                  ]
                }
              }
            }
          ],
          haloSize: 1,
          scaleX: 1,
          symbol3DProperties: {
            type: "CIM3DSymbolProperties",
            dominantSizeAxis3D: "Z",
            rotationOrder3D: "YXZ",
            scaleZ: 1,
            scaleY: 1
          },
          angleAlignment: "Display"
        }
      }
    });
    const hurricaneSymbol_south = new CIMSymbol({
      data: {
        type: "CIMSymbolReference",
        symbol: {
          type: "CIMPointSymbol",
          symbolLayers: [
            {
              type: "CIMVectorMarker",
              enable: true,
              colorLocked: true,
              anchorPointUnits: "Relative",
              dominantSizeAxis3D: "Y",
              size: 25,
              billboardMode3D: "FaceNearPlane",
              frame: {
                xmin: 0,
                ymin: 0,
                xmax: 25,
                ymax: 25
              },
              animations: [
                {
                  type: "CIMSymbolAnimationRotation",
                  // primitiveName: "scaleOverride",
                  toRotation: -360,
                  rotateClockwise: true,
                  animatedSymbolProperties: {
                    type: "CIMAnimatedSymbolProperties",
                    // primitiveName: "animationOverride",
                    playAnimation: true,
                    randomizeStartTime: false,
                    repeatType: "Loop",
                    repeatDelay: 0,
                    duration: 1.5
                  }
                }
              ],
              markerGraphics: [
                {
                  type: "CIMMarkerGraphic",
                  geometry: {
                    rings: southRings
                  },
                  symbol: {
                    type: "CIMPolygonSymbol",
                    symbolLayers: [
                      {
                        type: "CIMSolidFill",
                        enable: true,
                        color: [255, 87, 71, 255]
                      }
                    ],
                    angleAlignment: "Map"
                  }
                }
              ],
              scaleSymbolsProportionally: true,
              respectFrame: true,
              clippingPath: {
                type: "CIMClippingPath",
                clippingType: "Intersect",
                path: {
                  rings: [
                    [
                      [0, 0],
                      [25, 0],
                      [25, 25],
                      [0, 25],
                      [0, 0]
                    ]
                  ]
                }
              }
            }
          ],
          haloSize: 1,
          scaleX: 1,
          symbol3DProperties: {
            type: "CIM3DSymbolProperties",
            dominantSizeAxis3D: "Z",
            rotationOrder3D: "YXZ",
            scaleZ: 1,
            scaleY: 1
          },
          angleAlignment: "Display"
        }
      }
    });

    // Label expression for the latest observation
    const latestObservationsNameLabelExpression = `
      var label = iif($feature.Category > 0, $feature.Name + ' (' + $feature.Category + ')', $feature.Name);
      if(!HasValue($view, [ "timeProperties", "currentEnd" ])) {
        return null;
      }
      var e = $view.timeProperties.currentEnd;
      var t = $feature.ISO_time;
      var d = DateDiff(e, t, 'days');

      // only show label if the storm is active
      return iif(d <= 3, label, null);
    `;

    const dateDiffExpression = `
      if(!HasValue($view, [ "timeProperties", "currentEnd" ])) {
        return null;
      }
      var e = $view.timeProperties.currentEnd;
      var t = $feature.ISO_time;
      var d = DateDiff(e, t, 'days');
      return d;
    `;

    const latestObservationsLowerLabelExpression = `
      var labelParts = [
        Text($feature.ISO_time, "MMM D, Y h:mm A"),
        iif($feature.Category > 0, "Category " + $feature.Category, "Tropical Storm"),
        $feature.wmo_wind + " mph"
      ];
      var label = Concatenate(labelParts, TextFormatting.NewLine);
      if(!HasValue($view, [ "timeProperties", "currentEnd" ])) {
        return null;
      }
      var e = $view.timeProperties.currentEnd;
      var t = $feature.ISO_time;
      var d = DateDiff(e, t, 'days');
      iif(d <= 10, label, null);
    `;

    const previousObservationsRenderer = {
      type: "simple",
      label: "Previous hurricane location",
      symbol: {
        type: "simple-marker",
        outline: {
          color: (() => {
            const c = colors[5].clone();
            c.a = 0.2;
            return c;
          })(),
          width: 0,
        },
      },
      // vary size and color of previous observations based on category
      visualVariables: [
        {
          type: "size",
          field: "Category",
          legendOptions: {
            showLegend: true,
          },
          stops: [
            { value: 0, size: 2 },
            { value: 1, size: 4 },
            { value: 2, size: 5 },
            { value: 3, size: 6 },
            { value: 4, size: 8 },
            { value: 5, size: 10 },
          ],
        },
        {
          type: "color",
          field: "Category",
          legendOptions: {
            showLegend: true,
          },
          stops: [
            { value: 0, color: colors[0] },
            { value: 1, color: colors[1] },
            { value: 2, color: colors[2] },
            { value: 3, color: colors[3] },
            { value: 4, color: colors[4] },
            { value: 5, color: colors[5] },
          ],
        },
        {
          // fade previous observations based on position of time slider handle
          type: "opacity",
          valueExpression: dateDiffExpression,
          legendOptions: {
            showLegend: true,
          },
          stops: [
            { value: 7, opacity: 1 },
            { value: 14, opacity: 0.18 },
          ],
        },
      ],
    };

    const latestObservationsRenderer = {
      type: "class-breaks",
      field: "Latitude",
      classBreakInfos: [
        {
          minValue: -90,
          maxValue: 0,
          symbol: hurricaneSymbol_south,
        },
        {
          minValue: 0,
          maxValue: 90,
          symbol: hurricaneSymbol_north,
        },
      ],
      // vary size of latest observation based on category
      visualVariables: [
        {
          type: "size",
          field: "Category",
          stops: [
            { value: 1, size: 12 },
            { value: 2, size: 16 },
            { value: 3, size: 24 },
            { value: 4, size: 36 },
            { value: 5, size: 56 },
          ],
        },
        {
          // vary opacity of latest observation based on whether the storm is active
          // an active storm is one that has an observation at the position of the time slider
          // or was active within 3 days of the current time (this is for a fade out effect)
          type: "opacity",
          valueExpression: dateDiffExpression,
          legendOptions: {
            showLegend: false,
          },
          stops: [
            { value: 0, opacity: 1 },
            { value: 3, opacity: 0 },
          ],
        },
      ],
    };

    const trackLinesRenderer = {
      type: "simple",
      symbol: {
        type: "simple-line",
        color: (() => {
          const c = colors[3].clone();
          c.a = 1;
          return c;
        })(),
        width: 0.5,
      },
      visualVariables: [
        {
          type: "opacity",
          valueExpression: dateDiffExpression,
          legendOptions: {
            showLegend: false,
          },
          stops: [
            { value: 7, opacity: 1 },
            { value: 14, opacity: 0.18 },
          ],
        },
      ],
    };

    const layer = new GeoJSONLayer({
      effect: "bloom(2, 1px, 10%)",
      title: `Hurricanes (${startYear} - ${endYear})`,
      portalItem: {
        id: "13e2698365a14b0c9e403e38dc92f779",
      },
      opacity: 1,
      renderer: latestObservationsRenderer,
      definitionExpression: `Year >= ${startYear} AND Year <= ${endYear}`,
      popupTemplate: {
        title: "{Name}",
        content: [
          {
            type: "text",
            text: "Category {Category} storm with that occurred at {ISO_time}.",
          },
          {
            type: "fields",
            fieldInfos: [
              {
                fieldName: "wmo_pres",
                label: "Pressure",
              },
              {
                fieldName: "wmo_wind",
                label: "Wind Speed (mph)",
              },
            ],
          },
        ],
        fieldInfos: [
          {
            fieldName: "ISO_time",
            format: {
              dateFormat: "short-date-short-time",
            },
          },
        ],
      },
      timeInfo: {
        startField: "ISO_time",
        // field containing unique identifier for each track
        trackIdField: "Serial_Num",
      },
      trackInfo: {
        enabled: true,
        // display all observations in the track for duration of user session
        maxDisplayDuration: {
          value: 0,
          unit: "minutes",
        },
        // display all observations for each track
        maxDisplayObservationsPerTrack: 0,
        popupTemplate: {
          title: "Hurricane {Name}",
          content: "Average wind speed: {AVG_WIND} mph",
          fieldInfos: [
            {
              fieldName: "AVG_WIND",
              label: "Average Wind Speed",
              format: {
                places: 0,
                digitSeparator: true,
              },
            },
          ],
        },
        previousObservations: {
          // show previous observations as marker symbols
          visible: true,
          renderer: previousObservationsRenderer,
          // label recent observations with a fully opaque label
          // label older observations with a semi-transparent label
          labelingInfo: [
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[5],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 9,
                  family: "Noto Sans",
                  weight: "normal",
                },
                xoffset: 0,
                yoffset: 0,
              },
              minScale: 2311163,
              maxScale: 0,
              labelPlacement: "center-right",
              labelExpressionInfo: {
                expression: `
                  var labelParts = [
                    $feature.Name,
                    Text($feature.ISO_time, "MMM D, Y h:mm A"),
                    iif($feature.Category > 0, "Category " + $feature.Category, "Tropical Storm"),
                    $feature.wmo_wind + " mph"
                  ];
                  var label = Concatenate(labelParts, TextFormatting.NewLine);
                  if(!HasValue($view, [ "timeProperties", "currentEnd" ])) {
                    return null;
                  }
                  var e = $view.timeProperties.currentEnd;
                  var t = $feature.ISO_time;
                  var d = DateDiff(e, t, 'days');
                  iif(d <= 10, label, null);
                `,
              },
            },
            {
              symbol: {
                type: "text",
                color: (() => {
                  const c = colors[5].clone();
                  c.a = 0.35;
                  return c;
                })(),
                haloColor: "rgba(0,0,0,0.5)",
                haloSize: 1,
                font: {
                  size: 9,
                  family: "Noto Sans",
                  weight: "normal",
                },
                xoffset: 0,
                yoffset: 0,
              },
              minScale: 2311163,
              maxScale: 0,
              labelPlacement: "center-right",
              labelExpressionInfo: {
                expression: `
                  var labelParts = [
                    $feature.Name,
                    Text($feature.ISO_time, "MMM D, Y h:mm A"),
                    iif($feature.Category > 0, "Category " + $feature.Category, "Tropical Storm"),
                    $feature.wmo_wind + " mph"
                  ];
                  var label = Concatenate(labelParts, TextFormatting.NewLine);
                  if(!HasValue($view, [ "timeProperties", "currentEnd" ])) {
                    return null;
                  }
                  var e = $view.timeProperties.currentEnd;
                  var t = $feature.ISO_time;
                  var d = DateDiff(e, t, 'days');
                  iif(d > 10, label, null);
                `,
              },
            },
          ],
        },
        latestObservations: {
          // show latest observation as an animated picture marker
          visible: true,
          labelsVisible: true,
          // vary label size and color based on category
          labelingInfo: [
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[5],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 24,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -10,
                yoffset: -15,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 5",
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[4],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 20,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -5,
                yoffset: -10,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 4",
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[3],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 18,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -5,
                yoffset: -8,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 3",
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[2],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 14,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -5,
                yoffset: -5,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 2",
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[1],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 11,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -5,
                yoffset: -5,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 1",
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: plasma[0],
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 8,
                  family: "Noto Sans",
                  weight: "bold",
                },
                xoffset: -5,
                yoffset: -5,
              },
              labelPlacement: "above-right",
              labelExpressionInfo: {
                expression: latestObservationsNameLabelExpression,
              },
              where: "Category = 0",
            },
            {
              // when the user zooms in, show more detailed information
              // about the storm, including the time of the observation
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: "white",
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 10,
                  family: "Noto Sans",
                  weight: "normal",
                },
                xoffset: -6,
                yoffset: -2,
              },
              where: "Category = 5",
              minScale: 2311163,
              maxScale: 0,
              labelPlacement: "center-right",
              labelExpressionInfo: {
                expression: latestObservationsLowerLabelExpression,
              },
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: "white",
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 10,
                  family: "Noto Sans",
                  weight: "normal",
                },
                xoffset: -3,
                yoffset: -8,
              },
              where: "Category >= 3 AND Category < 5",
              minScale: 2311163,
              maxScale: 0,
              labelPlacement: "center-right",
              labelExpressionInfo: {
                expression: latestObservationsLowerLabelExpression,
              },
            },
            {
              deconflictionStrategy: "none",
              symbol: {
                type: "text",
                color: "white",
                haloColor: "black",
                haloSize: 1,
                font: {
                  size: 8,
                  family: "Noto Sans",
                  weight: "normal",
                },
                xoffset: -3,
                yoffset: -12,
              },
              minScale: 2311163,
              maxScale: 0,
              where: "Category <= 2",
              labelPlacement: "center-right",
              labelExpressionInfo: {
                expression: latestObservationsLowerLabelExpression,
              },
            },
          ],
          renderer: latestObservationsRenderer,
        },
        trackLines: {
          visible: true,
          renderer: trackLinesRenderer,
        },
        fields: [
          {
            name: "AVG_WIND",
            onStatisticField: "wmo_wind",
            statisticType: "avg",
          },
        ],
      },
    });

    viewElement.map = new WebMap({
      portalItem: {
        id: "5d36c6e206674a4f960f12e4e83f767b",
      },
      layers: [layer],
    });

    const start = new Date(startYear, 0, 1);
    const end = new Date(endYear, 11, 31);

    yearSlider.fullTimeExtent = {
      start,
      end,
    };
    yearSlider.timeExtent = {
      start,
      end: start,
    };
    yearSlider.stops = {
      interval: {
        value: 6,
        unit: "hours",
      },
    };
    viewElement.timeExtent = yearSlider.timeExtent;

    yearSelect.addEventListener("calciteSelectChange", (event) => {
      const selectedYear = parseInt(yearSelect.value);
      const newStart = new Date(selectedYear, 0, 1);
      const newEnd = new Date(selectedYear + 1, 11, 31);

      yearSlider.fullTimeExtent = {
        start: newStart,
        end: newEnd,
      };
      yearSlider.timeExtent = {
        start: newStart,
        end: newStart,
      };
      viewElement.timeExtent = yearSlider.timeExtent;
      layer.definitionExpression = `Year >= ${selectedYear} AND Year <= ${selectedYear + 1}`;
    });
  </script>
</body>

</html>